<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-image: url("bg.jpg");
      background-size: cover;
    }

    #bg {
      /* border: 1px solid; */
      display: flex;
    }

    .line {
      display: flex;
    }

    .container {
      /* border: 1px solid; */
      width: 610px;
      margin: auto;
      margin-top: 20px;
    }

    div {
      background-color: white;
    }

    img {
      border: 1px solid white;
      height: 200px;
      width: 200px;
    }

    .bg-img {
      border: 0;
    }

    .clicked {
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% {
        filter: brightness(150%);
      }

      50% {
        filter: brightness(50%);
      }

      100% {
        filter: brightness(150%);
      }
    }

    .unclick {
      width: 100%;
      height: 600px;
    }

    .unclick img {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

  <main>
    <container id="bg">
      <section class="unclick"><img class="bg-img" src="FFFFFF-1.png" width=100%></section>
      <section class="container">
        <section class="line">
          <div id="square-1"><img src="bart-img/image_part_001.png"></div>
          <div id="square-2"><img src="bart-img/image_part_002.png"></div>
          <div id="square-3"><img src="bart-img/image_part_003.png"></div>
        </section>

        <section class="line">
          <div id="square-4"><img src="bart-img/image_part_004.png"></div>
          <div id="square-5"><img src="bart-img/image_part_005.png"></div>
          <div id="square-6"><img src="bart-img/image_part_006.png"></div>
        </section>

        <section class="line">
          <div id="square-7"><img src="bart-img/image_part_007.png"></div>
          <div id="square-8"><img src="bart-img/image_part_008.png"></div>
          <div id="square-9"><img src="bart-img/image_part_009.png"></div>
        </section>
      </section>
      <section class="unclick"><img class="bg-img" src="FFFFFF-1.png"></section>
    </container>
  </main>

  <audio id="ID" autoplay>
    <source src="song.mp3" type="audio/mp3">
  </audio>

  <script>

    const squares = document.getElementsByTagName('div');

    function randomizeBoard() {
      imageArray = [1, 2, 3, 4, 5, 6, 7, 8, 9]

      for (let i = 0; i < 9; i += 1) {
        let rand = Math.ceil(Math.random() * imageArray.length);
        squares[i].innerHTML = `<img src="bart-img/image_part_00${imageArray[rand - 1]}.png">`
        imageArray.splice((rand - 1), 1);
      }
    }

    let selected = false;
    let selectedEl;
    let clickedEl;

    function addSquareClick() {
      for (let i = 0; i < squares.length; i += 1) {
        squares[i].addEventListener('click', function () {
          if (selected) {
            selectedEl = document.querySelector('.selected');
            selectedEl.classList.remove('clicked')
            selectedEl.classList.remove('selected')

            if (selectedEl !== squares[i]) {
              squares[i].classList.add('clicked');
              squares[i].classList.add('selected');
              // console.log(squares[i]);
              selectedEl = squares[i];
            } else {
              selected = false;
            }
          } else {
            squares[i].classList.add('clicked');
            squares[i].classList.add('selected');
            selected = true;
            selectedEl = squares[i];
            // console.log(selectedEl);
          }
        });
      }
    }

    function bgUnclick() {
      // Adiciona a funcionalidade de clicar no BG pra desclicar
      const unclickBack = document.getElementsByClassName('unclick');

      for (let i = 0; i < unclickBack.length; i += 1) {
        unclickBack[i].addEventListener('click', function () {
          if (selected) {
            const selectedEl = document.querySelector('.selected');
            const clickedEl = document.querySelector('.clicked');
            selectedEl.classList.remove('selected');
            clickedEl.classList.remove('clicked');
            selected = false;
          }
        })
      }
    }

    squareArray = [
      document.getElementById('square-1'),
      document.getElementById('square-2'),
      document.getElementById('square-3'),
      document.getElementById('square-4'),
      document.getElementById('square-5'),
      document.getElementById('square-6'),
      document.getElementById('square-7'),
      document.getElementById('square-8'),
      document.getElementById('square-9'),
    ]

    function setupSquares() {

      window.addEventListener('keyup', function (e) {
        let win = null;
        if (selected) { // sÃ³ funciona quando tiver algum quadrado selecionado
          selectedEl = document.querySelector('.selected');
          clickedEl = document.querySelector('.clicked');
          // console.log(selectedEl)
          let currentSquareNumber;
          let squareChange;

          const right = ['square-1', 'square-2', 'square-4', 'square-5', 'square-7', 'square-8'];
          if (right.includes(selectedEl.id) && e.keyCode === 39) {
            currentSquareNumber = selectedEl.id.split('-')[1];
            squareChange = squareArray[Number(currentSquareNumber)];

            const currentSquareHTML = selectedEl.innerHTML;
            selectedEl.innerHTML = squareChange.innerHTML;
            squareChange.innerHTML = currentSquareHTML;

            selectedEl.classList.remove('selected');
            squareArray[currentSquareNumber].classList.add('selected');
            clickedEl.classList.remove('clicked')
            squareArray[currentSquareNumber].classList.add('clicked');
          }

          const down = ['square-1', 'square-2', 'square-3', 'square-4', 'square-5', 'square-6'];
          if (down.includes(selectedEl.id) && e.keyCode === 40) {
            // console.log(`O elemento pode ir pra baixo`);
            currentSquareNumber = selectedEl.id.split('-')[1];
            squareChange = squareArray[Number(currentSquareNumber) + 2];
            // console.log(squareChange);

            const currentSquareHTML = selectedEl.innerHTML;
            selectedEl.innerHTML = squareChange.innerHTML;
            squareChange.innerHTML = currentSquareHTML;

            selectedEl.classList.remove('selected');
            squareChange.classList.add('selected');
            clickedEl.classList.remove('clicked')
            squareChange.classList.add('clicked');
          }

          const left = ['square-2', 'square-3', 'square-5', 'square-6', 'square-8', 'square-9'];
          if (left.includes(selectedEl.id) && e.keyCode === 37) {
            // console.log(`O elemento pode ir pra esquerda`);
            currentSquareNumber = selectedEl.id.split('-')[1];
            squareChange = squareArray[Number(currentSquareNumber) - 2];
            // console.log(squareChange)

            const currentSquareHTML = selectedEl.innerHTML;
            selectedEl.innerHTML = squareChange.innerHTML;
            squareChange.innerHTML = currentSquareHTML;

            selectedEl.classList.remove('selected');
            squareChange.classList.add('selected');
            clickedEl.classList.remove('clicked')
            squareChange.classList.add('clicked');
          }

          const up = ['square-4', 'square-5', 'square-6', 'square-7', 'square-8', 'square-9'];
          if (up.includes(selectedEl.id) && e.keyCode === 38) {
            // console.log(`O elemento pode ir pra cima`);
            currentSquareNumber = selectedEl.id.split('-')[1];
            squareChange = squareArray[Number(currentSquareNumber) - 4];

            const currentSquareHTML = selectedEl.innerHTML;
            selectedEl.innerHTML = squareChange.innerHTML;
            squareChange.innerHTML = currentSquareHTML;

            selectedEl.classList.remove('selected');
            squareChange.classList.add('selected');
            clickedEl.classList.remove('clicked')
            squareChange.classList.add('clicked');
          }

          for (let i = 0; i < 9; i += 1) {
            rightPhoto = `<img src="bart - img / image_part_00${i + 1}.png">`;

            // console.log(squareArray[i].innerHTML === )
            if (squareArray[i].innerHTML !== `<img src="bart-img/image_part_00${i + 1}.png">`) {
              win = false;
            }
          }

          if (win === null) {
            setTimeout(function () { alert('YOU WIN!!!') }, 500)
            selectedEl = document.querySelector('.selected');
            selectedEl.classList.remove('clicked')
            selectedEl.classList.remove('selected')
            selected = false;

            var snd = new Audio("clapping.wav"); // buffers automatically when created
            snd.play();
          }
        }
      });
    }

    function musicPlay() {
      document.getElementById('ID').play();
      document.removeEventListener('click', musicPlay);
    }




    window.onload = function () {
      randomizeBoard();
      setupSquares()
      addSquareClick();
      bgUnclick();

      document.addEventListener('click', musicPlay);
    };
  </script>
</body>

</html>
